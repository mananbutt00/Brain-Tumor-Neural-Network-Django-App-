<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Detection - Upload</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #1a0033, #0d001a, #1a0033, #0d001a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            z-index: -2;
            background: radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(255, 0, 127, 0.05) 0%, transparent 50%);
            animation: moveGradient 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(102, 126, 234, 0.15) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 70%, rgba(118, 75, 162, 0.15) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 0, 127, 0.08) 0%, transparent 50%);
            animation: floatGradient 25s ease-in-out infinite;
            pointer-events: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.6s ease-out;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(102, 126, 234, 0.05);
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .upload-text {
            color: #333;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        #imageInput {
            display: none;
        }

        .image-preview {
            margin-top: 20px;
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .image-preview img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            object-fit: cover;
        }

        .image-name {
            margin-top: 10px;
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results-container {
            display: none;
            animation: slideUp 0.6s ease-out;
        }

        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .prediction-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .prediction-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .confidence-container {
            margin-top: 20px;
        }

        .confidence-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .confidence-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 0.6s ease-out;
            width: 0%;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            text-transform: uppercase;
        }

        .tumor-detected {
            background: #dc3545;
            box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
        }

        .no-tumor {
            background: #28a745;
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
        }

        .detailed-report {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
            display: none;
        }

        .report-title {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            color: #333;
        }

        .report-item:last-child {
            border-bottom: none;
        }

        .report-label {
            font-weight: 600;
            color: #667eea;
        }

        .report-value {
            color: #555;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #667eea;
            font-weight: 600;
            margin-top: 15px;
            text-align: center;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .disclaimer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.8s ease-out;
        }

        .disclaimer h3 {
            color: #dc3545;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .disclaimer p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .button-group {
                flex-direction: column;
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes moveGradient {
            0% {
                transform: translate(0, 0) scale(1);
            }
            25% {
                transform: translate(50px, -50px) scale(1.1);
            }
            50% {
                transform: translate(100px, 0) scale(1);
            }
            75% {
                transform: translate(50px, 50px) scale(0.9);
            }
            100% {
                transform: translate(0, 0) scale(1);
            }
        }

        @keyframes floatGradient {
            0% {
                transform: translate(-50px, -50px);
                opacity: 0.8;
            }
            50% {
                transform: translate(50px, 50px);
                opacity: 1;
            }
            100% {
                transform: translate(-50px, -50px);
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Brain Tumor Detection</h1>
            <p>Advanced AI-Powered Medical Imaging Analysis</p>
        </div>

        <!-- Hidden data container for Django variables -->
        <div id="djangoData" style="display: none;" 
             data-prediction="{{ prediction }}" 
             data-confidence="{{ confidence }}">
        </div>

        <div class="content">
            <!-- Upload Section -->
            <div class="card">
                <h2>üì§ Upload Brain MRI Image</h2>
                
                <div class="alert alert-success" id="successAlert"></div>
                <div class="alert alert-error" id="errorAlert"></div>

                <form id="uploadForm" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Click to upload or drag and drop</div>
                        <div class="upload-subtext">PNG, JPG, BMP, GIF up to 10MB</div>
                    </div>

                    <input type="file" id="imageInput" name="image" accept="image/*" required>

                    <div class="image-preview" id="imagePreview">
                        <img id="previewImg" src="" alt="Preview">
                        <div class="image-name" id="imageName"></div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" id="predictBtn" disabled>
                            üîç Analyze Image
                        </button>
                        <button type="reset" class="btn btn-secondary" id="resetBtn">
                            üîÑ Clear
                        </button>
                    </div>

                    <div class="loading-text" id="loadingText" style="display: none;">
                        <div class="spinner"></div>
                        Processing image with AI model...
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div class="card">
                <h2>üìä Analysis Results</h2>
                
                <div id="noResultsMessage" style="text-align: center; color: #999; padding: 40px 0;">
                    <p style="font-size: 1rem;">Upload an image to see analysis results here</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">üëà Use the upload section on the left</p>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="result-box" id="resultBox">
                        <div class="prediction-label">Prediction Result</div>
                        <div class="prediction-value" id="predictionValue"></div>
                        
                        <div class="confidence-container">
                            <div class="confidence-label">
                                <span>Confidence Score</span>
                                <span id="confidencePercent">0%</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill"></div>
                            </div>
                        </div>

                        <div class="status-badge" id="statusBadge"></div>
                    </div>

                    <div class="detailed-report" id="detailedReport">
                        <div class="report-title">üìã Detailed Report</div>
                        <div class="report-item">
                            <span class="report-label">Prediction:</span>
                            <span class="report-value" id="reportPrediction"></span>
                        </div>
                        <div class="report-item">
                            <span class="report-label">Confidence:</span>
                            <span class="report-value" id="reportConfidence"></span>
                        </div>
                        <div class="report-item">
                            <span class="report-label">Status:</span>
                            <span class="report-value" id="reportStatus"></span>
                        </div>
                        <div class="report-item">
                            <span class="report-label">Recommendation:</span>
                            <span class="report-value" id="reportRecommendation"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <h3>‚öïÔ∏è Medical Disclaimer</h3>
            <p>
                This tool is for research and educational purposes only. It should not replace professional medical diagnosis and consultation. 
                Always consult with qualified healthcare professionals for medical decisions and diagnosis. The results provided by this AI model 
                are not a substitute for professional medical advice, diagnosis, or treatment.
            </p>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const uploadForm = document.getElementById('uploadForm');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const imageName = document.getElementById('imageName');
        const predictBtn = document.getElementById('predictBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loadingText = document.getElementById('loadingText');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const resultBox = document.getElementById('resultBox');
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const djangoData = document.getElementById('djangoData');

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                imageInput.files = files;
                handleFileSelect();
            }
        });

        // Click to upload
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', handleFileSelect);

        function handleFileSelect() {
            const file = imageInput.files[0];
            if (file) {
                // Validate file
                const validTypes = ['image/jpeg', 'image/png', 'image/bmp', 'image/gif'];
                const maxSize = 10 * 1024 * 1024; // 10MB

                if (!validTypes.includes(file.type)) {
                    showError('Invalid file type. Please upload JPG, PNG, BMP, or GIF.');
                    imageInput.value = '';
                    return;
                }

                if (file.size > maxSize) {
                    showError('File size exceeds 10MB limit.');
                    imageInput.value = '';
                    return;
                }

                // Show preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    imageName.textContent = file.name;
                    imagePreview.style.display = 'block';
                    predictBtn.disabled = false;
                    showSuccess('File selected successfully!');
                };
                reader.readAsDataURL(file);
            }
        }

        // Form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(uploadForm);
            predictBtn.disabled = true;
            loadingText.style.display = 'block';
            resultsContainer.style.display = 'none';
            noResultsMessage.style.display = 'none';

            try {
                const response = await fetch(window.location.href, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    showError('Server error: ' + response.status);
                    return;
                }

                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Extract prediction and confidence from response
                const dataElement = doc.getElementById('djangoData');
                const prediction = dataElement?.getAttribute('data-prediction');
                const confidence = dataElement?.getAttribute('data-confidence');

                if (prediction && prediction !== 'None' && confidence && confidence !== 'None') {
                    displayResults(prediction, parseFloat(confidence));
                    showSuccess('Analysis completed successfully!');
                } else {
                    showError('Failed to get prediction results. Please try again.');
                }
            } catch (error) {
                showError('Error during analysis: ' + error.message);
                console.error('Error:', error);
            } finally {
                predictBtn.disabled = false;
                loadingText.style.display = 'none';
            }
        });

        function displayResults(prediction, confidence) {
            noResultsMessage.style.display = 'none';
            resultsContainer.style.display = 'block';

            // Update prediction
            const predictionValue = document.getElementById('predictionValue');
            const statusBadge = document.getElementById('statusBadge');
            const confidenceFill = document.getElementById('confidenceFill');
            const confidencePercent = document.getElementById('confidencePercent');

            predictionValue.textContent = prediction.charAt(0).toUpperCase() + prediction.slice(1);
            confidencePercent.textContent = confidence.toFixed(2) + '%';

            // Set color based on prediction
            if (prediction.toLowerCase().includes('notumor')) {
                resultBox.classList.remove('tumor-detected');
                resultBox.classList.add('no-tumor');
                statusBadge.textContent = '‚úÖ Normal';
            } else {
                resultBox.classList.remove('no-tumor');
                resultBox.classList.add('tumor-detected');
                statusBadge.textContent = '‚ö†Ô∏è Tumor Detected';
            }

            // Animate confidence bar
            setTimeout(() => {
                confidenceFill.style.width = confidence + '%';
            }, 100);

            // Update detailed report
            updateDetailedReport(prediction, confidence);
        }

        function updateDetailedReport(prediction, confidence) {
            const detailedReport = document.getElementById('detailedReport');
            detailedReport.style.display = 'block';

            document.getElementById('reportPrediction').textContent = 
                prediction.charAt(0).toUpperCase() + prediction.slice(1);
            document.getElementById('reportConfidence').textContent = confidence.toFixed(2) + '%';

            const isTumor = !prediction.toLowerCase().includes('notumor');
            document.getElementById('reportStatus').textContent = 
                isTumor ? 'High Risk - Further examination needed' : 'Normal - No tumor detected';
            document.getElementById('reportRecommendation').textContent = 
                isTumor ? 'Immediate consultation with radiologist recommended' : 'Regular follow-up recommended';
        }

        function showSuccess(message) {
            successAlert.textContent = '‚úÖ ' + message;
            successAlert.style.display = 'block';
            errorAlert.style.display = 'none';
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 4000);
        }

        function showError(message) {
            errorAlert.textContent = '‚ùå ' + message;
            errorAlert.style.display = 'block';
            successAlert.style.display = 'none';
            setTimeout(() => {
                errorAlert.style.display = 'none';
            }, 4000);
        }

        // Reset button
        resetBtn.addEventListener('click', () => {
            uploadForm.reset();
            imagePreview.style.display = 'none';
            resultsContainer.style.display = 'none';
            noResultsMessage.style.display = 'block';
            predictBtn.disabled = true;
            successAlert.style.display = 'none';
            errorAlert.style.display = 'none';
        });

        // Check if there's a prediction on initial page load
        window.addEventListener('load', () => {
            const prediction = djangoData?.getAttribute('data-prediction');
            const confidence = djangoData?.getAttribute('data-confidence');
            
            if (prediction && prediction !== 'None' && confidence && confidence !== 'None') {
                displayResults(prediction, parseFloat(confidence));
                showSuccess('Analysis completed!');
            }
        });
    </script>
</body>
</html>